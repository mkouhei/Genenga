MAKEINDEX:=mendex -f -g
SRCDIR:=.

all: address.pdf
address.dvi: address.tex

%.pdf: %.dvi
	dvipdfmx -p 100mm,148mm -f template/vlpgothic.map $<

%.dvi: %.tex
	## end of linting stuff
	platex $< # create draft input
	-$(MAKEINDEX) -s address.ist $(<:%.tex=%)
	platex $< # create draft content with correct spacing for index and toc
	-$(MAKEINDEX) -s address.ist $(<:%.tex=%) # recreate index with correct page number
	platex $< # recreate toc with correct page number


check-precommit:
	make address.dvi

clean:
	rm -f *~ *.aux *.log *.toc comment.cut
	rm -f *.dvi *.lof *.lot *.idx *.ind *.ilg *.bbl *.blg *.out

cleanall: clean
	rm -f address.pdf

$(PDF):	address.pdf
	cp $< $@

.PHONY: all clean check-precommit cleanall
